<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniAI | Native Direct</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script type="importmap">
        { "imports": { "@google/generative-ai": "https://esm.run/@google/generative-ai" } }
    </script>

    <style>
        body { background: #0f172a; color: #f1f5f9; overflow: hidden; }
        .sidebar { background: #1e293b; border-right: 1px solid #334155; width: 280px; }
        .view { display: none; height: 100%; flex-direction: column; }
        .view.active { display: flex; }
        .active-tab { background: #4f46e5; color: white; border-radius: 12px; }
    </style>
</head>
<body class="flex h-screen">

    <aside class="sidebar flex flex-col p-6">
        <div class="text-2xl font-black mb-10 text-indigo-400 flex items-center gap-2">
            <i class="fas fa-microchip"></i> OmniAI
        </div>
        
        <nav class="flex-1 space-y-2">
            <button onclick="switchView('chat')" id="tab-chat" class="w-full text-left p-3 flex items-center gap-3 active-tab transition">
                <i class="fas fa-comment-dots"></i> Smart Chat
            </button>
            <button onclick="switchView('settings')" id="tab-settings" class="w-full text-left p-3 flex items-center gap-3 hover:bg-slate-700 rounded-xl transition">
                <i class="fas fa-cog"></i> API Config
            </button>
        </nav>

        <div class="mt-auto p-4 bg-slate-800/50 rounded-2xl border border-slate-700 text-[10px] text-slate-500 font-bold uppercase tracking-widest text-center">
            Local Storage Mode
        </div>
    </aside>

    <main class="flex-1 flex flex-col">
        <section id="chat-view" class="view active">
            <header class="p-4 border-b border-slate-800 bg-slate-900/50 flex justify-between px-8">
                <div class="flex items-center gap-4">
                    <span class="text-xs font-bold text-slate-500 uppercase">Active Engine:</span>
                    <select id="modelSelect" class="bg-slate-800 border-none rounded-lg px-3 py-1 text-xs text-indigo-300 outline-none">
                        <option value="gemini">Google Gemini 1.5</option>
                        <option value="chatgpt">ChatGPT (GPT-4o)</option>
                    </select>
                </div>
                <button onclick="clearChat()" class="text-[10px] text-slate-500 hover:text-red-400">Clear History</button>
            </header>

            <div id="chatBox" class="flex-1 overflow-y-auto p-8 space-y-6"></div>

            <div class="p-6">
                <div class="max-w-4xl mx-auto flex gap-3 bg-slate-800 p-2 rounded-2xl border border-slate-700 shadow-xl">
                    <input type="text" id="userInput" placeholder="Ask anything..." class="flex-1 bg-transparent px-4 outline-none">
                    <button onclick="handleSend()" class="bg-indigo-600 w-12 h-12 rounded-xl flex items-center justify-center hover:bg-indigo-500 transition shadow-lg shadow-indigo-500/20">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </section>

        <section id="settings-view" class="view p-12 items-center justify-center">
            <div class="bg-slate-900 p-10 rounded-3xl border border-slate-800 w-full max-w-md shadow-2xl">
                <h2 class="text-2xl font-bold mb-6">API Configuration</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="text-[10px] font-bold text-slate-500 uppercase">Google Gemini Key</label>
                        <input type="password" id="geminiKey" placeholder="Enter Gemini Key" class="w-full bg-slate-800 p-3 rounded-xl mt-1 border border-slate-700 outline-none focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-500 uppercase">OpenAI Key (ChatGPT)</label>
                        <input type="password" id="openaiKey" placeholder="Enter ChatGPT Key" class="w-full bg-slate-800 p-3 rounded-xl mt-1 border border-slate-700 outline-none focus:border-indigo-500">
                    </div>
                </div>

                <button onclick="saveSettings()" class="w-full bg-indigo-600 p-4 rounded-xl mt-8 font-bold hover:bg-indigo-500 transition">Save Keys</button>
            </div>
        </section>
    </main>

    <script type="module">
        import { GoogleGenAI } from "@google/generative-ai";

        // Navigation
        window.switchView = (v) => {
            document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(e => e.classList.remove('active-tab'));
            document.getElementById(`${v}-view`).classList.add('active');
            document.getElementById(`tab-${v}`).classList.add('active-tab');
        }

        // Settings
        window.saveSettings = () => {
            localStorage.setItem('gemini_key', document.getElementById('geminiKey').value);
            localStorage.setItem('openai_key', document.getElementById('openaiKey').value);
            alert("API Keys updated!");
            switchView('chat');
        }

        // Initialize Keys
        document.getElementById('geminiKey').value = localStorage.getItem('gemini_key') || '';
        document.getElementById('openaiKey').value = localStorage.getItem('openai_key') || '';

        // Chat Logic
        window.handleSend = async () => {
            const prompt = document.getElementById('userInput').value;
            const engine = document.getElementById('modelSelect').value;
            if(!prompt) return;

            appendMsg(prompt, 'user');
            document.getElementById('userInput').value = '';
            const loading = appendMsg("...", 'ai');

            try {
                let reply = "";
                if (engine === 'gemini') {
                    const key = localStorage.getItem('gemini_key');
                    const genAI = new GoogleGenAI(key);
                    const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                    const result = await model.generateContent(prompt);
                    reply = result.response.text();
                } else {
                    const key = localStorage.getItem('openai_key');
                    const res = await fetch("https://api.openai.com/v1/chat/completions", {
                        method: "POST",
                        headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
                        body: JSON.stringify({ model: "gpt-4o", messages: [{role:"user", content: prompt}] })
                    });
                    const data = await res.json();
                    reply = data.choices[0].message.content;
                }
                loading.remove();
                appendMsg(reply, 'ai');
            } catch (e) {
                loading.innerHTML = `<span class="text-red-400 text-xs">Error: Check API Key/Network.</span>`;
            }
        }

        function appendMsg(text, role) {
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            div.innerHTML = `<div class="${role === 'user' ? 'bg-indigo-600' : 'bg-slate-800'} p-4 rounded-2xl max-w-[85%] text-sm shadow-md">${marked.parse(text)}</div>`;
            document.getElementById('chatBox').appendChild(div);
            document.getElementById('chatBox').scrollTop = document.getElementById('chatBox').scrollHeight;
            return div;
        }

        window.clearChat = () => document.getElementById('chatBox').innerHTML = '';
    </script>
</body>
</html>
