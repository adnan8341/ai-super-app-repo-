<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniAI | Native Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script type="importmap">
        { "imports": { "@google/generative-ai": "https://esm.run/@google/generative-ai" } }
    </script>

    <style>
        body { background: #0b0f1a; color: #e2e8f0; height: 100vh; display: flex; overflow: hidden; font-family: 'Inter', sans-serif; }
        .sidebar { width: 280px; background: #111827; border-right: 1px solid #1f2937; display: flex; flex-direction: column; }
        .active-tab { background: #3730a3; border-left: 4px solid #6366f1; color: white; }
        .chat-container { flex: 1; display: flex; flex-direction: column; background: #0b0f1a; position: relative; }
        #chatBox { flex: 1; overflow-y: auto; scroll-behavior: smooth; padding: 2rem; }
        .msg-user { background: #4f46e5; border-radius: 1.25rem 1.25rem 0 1.25rem; }
        .msg-ai { background: #1f2937; border-radius: 1.25rem 1.25rem 1.25rem 0; border: 1px solid #374151; }
        .input-bar { background: #111827; border-top: 1px solid #1f2937; padding: 1.5rem; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 10px; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="p-8">
            <div class="flex items-center gap-3 text-2xl font-black text-white">
                <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-500/20">
                    <i class="fas fa-brain text-sm"></i>
                </div>
                OmniAI
            </div>
        </div>
        
        <nav class="flex-1 px-4 space-y-2">
            <button onclick="showPage('chat')" id="tab-chat" class="w-full flex items-center gap-4 p-4 rounded-xl active-tab transition-all">
                <i class="fas fa-terminal text-lg"></i>
                <span class="font-semibold">AI Console</span>
            </button>
            <button onclick="showPage('settings')" id="tab-settings" class="w-full flex items-center gap-4 p-4 rounded-xl text-slate-400 hover:bg-slate-800 transition-all">
                <i class="fas fa-shield-halved text-lg"></i>
                <span class="font-semibold">API Keys</span>
            </button>
        </nav>

        <div class="p-6">
            <div class="p-4 bg-slate-900/50 rounded-2xl border border-slate-800">
                <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1">Status</p>
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-xs font-medium text-slate-300">Local Session Active</span>
                </div>
            </div>
        </div>
    </aside>

    <main class="chat-container">
        
        <div id="page-chat" class="flex flex-col h-full">
            <header class="h-20 border-b border-slate-800 flex items-center justify-between px-8 bg-slate-900/20">
                <div class="flex items-center gap-4">
                    <select id="engineSelect" class="bg-slate-800 text-indigo-400 text-xs font-bold py-2 px-4 rounded-lg border border-slate-700 outline-none">
                        <option value="gemini">GOOGLE GEMINI 1.5</option>
                        <option value="openai">CHATGPT GPT-4O</option>
                    </select>
                </div>
                <button onclick="document.getElementById('chatBox').innerHTML=''" class="text-[10px] font-bold text-slate-500 hover:text-red-400 transition">CLEAR HISTORY</button>
            </header>

            <div id="chatBox">
                <div class="max-w-3xl mx-auto opacity-40 text-center mt-20">
                    <i class="fas fa-bolt text-4xl mb-4 text-indigo-500"></i>
                    <h3 class="text-xl font-bold text-white">System Ready</h3>
                    <p class="text-sm">Select your engine and start a conversation.</p>
                </div>
            </div>

            <div class="input-bar">
                <div class="max-w-4xl mx-auto relative group">
                    <input type="text" id="userInput" placeholder="Ask anything or type '/' for commands..." 
                        class="w-full bg-slate-800/50 border border-slate-700 text-white rounded-2xl py-4 pl-6 pr-20 outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all">
                    <button onclick="send()" class="absolute right-2 top-2 bottom-2 px-6 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl transition-all shadow-lg shadow-indigo-600/20">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="page-settings" class="hidden h-full flex items-center justify-center p-6">
            <div class="bg-slate-900 p-10 rounded-3xl border border-slate-800 w-full max-w-md shadow-2xl">
                <h2 class="text-2xl font-bold text-white mb-2">API Configuration</h2>
                <p class="text-slate-500 text-sm mb-8">Your keys are stored locally in your browser.</p>
                
                <div class="space-y-6">
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Google Gemini API Key</label>
                        <input type="password" id="gemKey" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-xl mt-2 text-white outline-none focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">OpenAI API Key</label>
                        <input type="password" id="opnKey" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-xl mt-2 text-white outline-none focus:border-indigo-500">
                    </div>
                    <button onclick="saveKeys()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-2xl shadow-xl shadow-indigo-600/20 transition-all">
                        Save Configuration
                    </button>
                </div>
            </div>
        </div>

    </main>

    <script type="module">
        import { GoogleGenAI } from "@google/generative-ai";

        // Navigation
        window.showPage = (id) => {
            document.getElementById('page-chat').classList.toggle('hidden', id !== 'chat');
            document.getElementById('page-settings').classList.toggle('hidden', id !== 'settings');
            document.getElementById('tab-chat').classList.toggle('active-tab', id === 'chat');
            document.getElementById('tab-settings').classList.toggle('active-tab', id === 'settings');
        };

        // Key Management
        window.saveKeys = () => {
            localStorage.setItem('gemini_api_key', document.getElementById('gemKey').value);
            localStorage.setItem('openai_api_key', document.getElementById('opnKey').value);
            alert("API Keys Synchronized Locally!");
            showPage('chat');
        };

        document.getElementById('gemKey').value = localStorage.getItem('gemini_api_key') || '';
        document.getElementById('opnKey').value = localStorage.getItem('openai_api_key') || '';

        // Core Chat Logic
        window.send = async () => {
            const input = document.getElementById('userInput');
            const prompt = input.value.trim();
            const engine = document.getElementById('engineSelect').value;

            if (!prompt) return;

            // Clear placeholder and append user message
            if (document.querySelector('#chatBox h3')) document.getElementById('chatBox').innerHTML = '';
            appendMsg(prompt, 'user');
            input.value = '';

            const loadingId = 'ai-' + Date.now();
            appendMsg("Generating response...", 'ai', loadingId);

            try {
                let responseText = "";
                if (engine === 'gemini') {
                    const key = localStorage.getItem('gemini_api_key');
                    const genAI = new GoogleGenAI(key);
                    const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                    const result = await model.generateContent(prompt);
                    responseText = result.response.text();
                } else {
                    const key = localStorage.getItem('openai_api_key');
                    const res = await fetch("https://api.openai.com/v1/chat/completions", {
                        method: "POST",
                        headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
                        body: JSON.stringify({ model: "gpt-4o", messages: [{role: "user", content: prompt}] })
                    });
                    const data = await res.json();
                    responseText = data.choices[0].message.content;
                }
                document.getElementById(loadingId).innerHTML = marked.parse(responseText);
            } catch (err) {
                document.getElementById(loadingId).innerHTML = `<span class="text-red-400">Error: Please verify your API Key in settings.</span>`;
            }
        };

        function appendMsg(text, role, id = null) {
            const box = document.getElementById('chatBox');
            const wrapper = document.createElement('div');
            wrapper.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} mb-6`;
            
            wrapper.innerHTML = `
                <div id="${id || ''}" class="${role === 'user' ? 'msg-user' : 'msg-ai'} p-5 max-w-[85%] text-sm leading-relaxed shadow-lg">
                    ${role === 'user' ? text : marked.parse(text)}
                </div>
            `;
            
            box.appendChild(wrapper);
            box.scrollTop = box.scrollHeight;
            return wrapper;
        }

        // Enter key support
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') send();
        });
    </script>
</body>
</html>
